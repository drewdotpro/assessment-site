---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import YAML from 'yaml';
import fs from 'fs';
import path from 'path';

// Get SITE_ID from environment
const SITE_ID = process.env.SITE_ID;
if (!SITE_ID) {
  throw new Error('SITE_ID environment variable is required');
}

// Load site-specific settings using direct YAML file reading
const settingsPath = path.join(process.cwd(), `src/content/${SITE_ID}/site-settings.yaml`);
const settings = YAML.parse(fs.readFileSync(settingsPath, 'utf8'));

// Import all logos using glob
const images = import.meta.glob<{ default: ImageMetadata }>('../assets/images/**/*.{svg,png,jpg}', {
  eager: true,
});

// Get logo from CMS path
const getLogo = (cmsPath: string) => {
  // Extract filename from CMS path (e.g., '~/assets/images/logo-light.svg' -> 'logo-light.svg')
  const filename = cmsPath.split('/').pop();

  // Build site-specific path
  const imagePath = `../assets/images/${SITE_ID}/${filename}`;
  const image = images[imagePath];

  if (!image) {
    throw new Error(`Logo not found: ${imagePath}`);
  }

  return image.default;
};

const logoLight = getLogo(settings.logo.light);
const logoDark = getLogo(settings.logo.dark);
---

<div class="flex items-center">
  <Image src={logoLight} alt={settings.logo.alt} class="h-8 w-auto dark:hidden" width={120} height={40} />
  <Image src={logoDark} alt={settings.logo.alt} class="h-8 w-auto hidden dark:block" width={120} height={40} />
</div>
